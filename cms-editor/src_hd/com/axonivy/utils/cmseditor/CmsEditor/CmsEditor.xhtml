<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:ic="http://ivyteam.ch/jsf/component" xmlns:p="http://primefaces.org/ui"
  xmlns:pe="http://primefaces.org/ui/extensions">
<h:body>
  <ui:composition template="/layouts/frame-10-full-width.xhtml">
    <ui:define name="title">#{ivy.cms.co('/Labels/CMSEditor/name')}</ui:define>
    <ui:define name="content">
      <h:outputStylesheet name="layouts/styles/translatinglanguages.css" />

      <h:form id="content-form" onkeypress="if (event.keyCode == 13){return false;}">
        <h:panelGroup styleClass="flex flex-column">
          <!-- Title -->
          <div class="mb-2">
            <span class="text-xl font-small">Project-CMS</span>
          </div>
          <div class="grid align-items-center">
            <div class="col-4">
              <p:selectOneMenu id="app" value="#{cmsEditorBean.selectedProjectName}" class="w-full">
                <f:selectItem itemLabel="All" itemValue="#{null}" />
                <f:selectItems value="#{cmsEditorBean.projectCms}" />
                <p:ajax process="@this"
                  update="content-form:table-cms-keys content-form:cms-values content-form:table-cms-keys content-form:cms-edit-value"
                  listener="#{cmsEditorBean.onAppChange}" />
              </p:selectOneMenu>
            </div>

            <div class="col-8">
              <span class="ui-input-icon-left w-full"> <i class="pi pi-search" /> <p:inputText id="search-input"
                  value="#{cmsEditorBean.searchKey}" placeholder="#{ivy.cms.co('/Labels/Search')}"
                  styleClass="w-full p-inputtext">
                  <p:ajax event="keyup" listener="#{cmsEditorBean.search}"
                    update="table-cms-keys content-form:cms-values content-form:cms-edit-value" delay="500"
                    process="@this" />
                </p:inputText>
              </span>
            </div>
          </div>

          <div class="grid h-full">
            <div class="col-4">
              <div class="font-semibold text-lg mb-2">#{ivy.cms.co('/Labels/Links')}</div>
              <h:panelGroup styleClass="panel left w-full border-none">
                <p:dataTable id="table-cms-keys" value="#{cmsEditorBean.filteredCMSKeys}" var="entry"
                  selection="#{cmsEditorBean.selectedCms}" selectionMode="single" rowKey="#{entry.uri}"
                  scrollHeight="100%" rows="30" paginatorPosition="bottom" pageLinks="5"
                  paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                  currentPageReportTemplate="{startRecord}-{endRecord} of {totalRecords} records"
                  rowsPerPageTemplate="20,30,40">
                  <p:column>
                    <div class="link-row">
                      <h:outputText id="cms-uri" class="cms-uri" value="#{entry.pmvName}#{entry.uri}" />
                      <h:panelGroup rendered="#{entry.differentWithApplication}">
                        <span class="orange-dot"></span>
                      </h:panelGroup>
                    </div>
                    <p:tooltip for="cms-uri" value="#{entry.uri}" position="top" />
                  </p:column>
                  <p:ajax event="rowSelect" process="@this" partialSubmit="true" listener="#{cmsEditorBean.rowSelect}" />
                </p:dataTable>
              </h:panelGroup>
            </div>

            <div class="col-4 flex flex-column" style="min-height: 0">
              <div class="font-semibold text-lg mb-2">#{ivy.cms.co('/Labels/CMS')}</div>
              <h:panelGroup styleClass="panel w-full border-none flex flex-column flex-grow-1" layout="block"
                style="min-height:0">
                <h:panelGroup styleClass="flex-grow-1 overflow-auto cms-scroll-wrapper" layout="block"
                  style="min-height:0">
                  <p:accordionPanel id="cms-values" multiple="true" widgetVar="multiple"
                    value="#{cmsEditorBean.selectedCms.contents}" activeIndex="#{cmsEditorBean.activeIndex}"
                    var="language">
                    <p:tab title="#{language.locale.displayLanguage}">
                      <h:panelGroup styleClass="ui-fluid">
                        <ic:com.axonivy.utils.cmseditor.component.Editor content="#{language.content}"
                          languageIndex="#{language.index}" managedBean="#{cmsEditorBean}" isReadOnly="true"
                          isFormatButtonListVisible="#{language.html}" />
                      </h:panelGroup>
                    </p:tab>
                  </p:accordionPanel>
                </h:panelGroup>
                <p:commandButton id="downloadButton" value="#{ivy.cms.co('/Labels/Download')}" ajax="false"
                  icon="pi pi-arrow-down" actionListener="#{cmsEditorBean.handleBeforeDownloadFile}"
                  styleClass="w-full mt-3" onclick="PrimeFaces.monitorDownload(function() {}, stop);">
                  <p:fileDownload value="#{cmsEditorBean.fileDownload}" />
                </p:commandButton>
              </h:panelGroup>
            </div>

            <h:panelGroup layout="block" styleClass="col-4 flex flex-column editable-column" id="editable-column"
              style="min-height: 0">
              <div class="font-semibold text-lg mb-2">#{ivy.cms.co('/Labels/Edit')}</div>
              <h:panelGroup styleClass="panel end w-full border-none flex flex-column flex-grow-1" layout="block"
                style="min-height:0">
                <h:panelGroup styleClass="flex-grow-1 overflow-auto cms-scroll-wrapper" layout="block"
                  style="min-height:0">
                  <p:accordionPanel id="cms-edit-value" multiple="true" widgetVar="multipleEdit"
                    value="#{cmsEditorBean.selectedCms.contents}" activeIndex="#{cmsEditorBean.activeIndex}"
                    var="language">
                    <p:tab title="#{language.locale.displayLanguage}">
                      <h:panelGroup styleClass="ui-fluid">
                        <ic:com.axonivy.utils.cmseditor.component.Editor content="#{language.content}"
                          languageIndex="#{language.index}" managedBean="#{cmsEditorBean}"
                          isReadOnly="#{!cmsEditorBean.editableCms}" isFormatButtonListVisible="#{language.html}" />
                      </h:panelGroup>
                    </p:tab>
                  </p:accordionPanel>
                </h:panelGroup>

                <p:commandButton id="editButton" value="#{ivy.cms.co('/Labels/Edit')}" icon="pi pi-pencil" ajax="false"
                  process="@this" update="cms-edit-value"
                  styleClass="w-full mt-3 ui-button-outlined ui-button-secondary"
                  actionListener="#{cmsEditorBean.onEditableButton()}" rendered="#{!cmsEditorBean.editableCms}"
                  disabled="#{cmsEditorBean.disableEditableButton}" />

                <h:panelGroup id="edit-cancel-updating-cms-group" styleClass="flex gap-2"
                  rendered="#{cmsEditorBean.editableCms}">
                  <p:commandButton value="#{ivy.cms.co('/Labels/Cancel')}" icon="pi pi-times" process="@this"
                    rendered="#{cmsEditorBean.editableCms}" styleClass="flex-1 ui-button-outlined ui-button-secondary"
                    actionListener="#{cmsEditorBean.onCancelEditableButton()}" update="content-form:editable-column" />
                  <p:commandButton value="#{ivy.cms.co('/Labels/Save')}" icon="pi pi-save" process="@this"
                    rendered="#{cmsEditorBean.editableCms}" actionListener="#{cmsEditorBean.writeCmsToApplication()}"
                    update="content-form:editable-column" styleClass="flex-1 ui-button-raised ui-button-primary" />
                </h:panelGroup>
              </h:panelGroup>
            </h:panelGroup>
          </div>
        </h:panelGroup>
        <div class="command-btns pt-2">
          <p:commandButton id="cancel-button" widgetVar="cancel-button" value="#{ivy.cms.co('/Labels/Cancel')}"
            actionListener="#{logic.close}" process="@this" immediate="true" styleClass="ml-2 mr-2 ui-button-flat" />

          <p:remoteCommand name="stop" global="false" partialSubmit="true" process="@this" update="content-form"
            actionListener="#{cmsEditorBean.downloadFinished}" />
        </div>
      </h:form>
      <script type="text/javascript">
        window.isHideTaskName = false;
        window.isHideTaskAction = true;
        window.isHideCaseInfo = true;
        window.isWorkingOnATask = false;
      </script>
    </ui:define>
  </ui:composition>
</h:body>

</html>